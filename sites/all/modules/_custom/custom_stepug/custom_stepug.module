<?php

/**
* Implements hook_library().
*/
function custom_stepug_library() {
  $libraries['jquery_ui_spinner'] = array(
    'title' => 'jQuery Spinner',
    'website' => 'http://github.com/btburnett3/jquery.ui.spinner/',
    'version' => '1.8',
    'js' => array(
      libraries_get_path('jquery_ui_spinner') . '/ui.spinner.min.js' => array(),
    ),
    'css' => array(
      libraries_get_path('jquery_ui_spinner') . '/ui.spinner.css' => array(),
    ),
    'dependencies' => array(
      array('system', 'ui.widget'),
    ),
  );
  return $libraries;
}

function custom_stepug_form_alter(&$form, &$form_state, $form_id) {
  if (strstr($form_id, 'commerce_cart_add_to_cart_form')) {
    $form['#attached']['library'][] = array('custom_stepug', 'jquery_ui_spinner');
    $form['quantity']['#title'] = '';
    $form['quantity']['#size'] = 1;
  }

  //Прячем кнопку поиска и делаем плэйсхолдер для поля поиска
  if ($form_id == 'search_block_form') {
    $form['search_block_form']['#attributes']['placeholder'] = t('Search');
    //$form['actions']['#attributes']['class'][] = 'element-invisible';
  }

  // убираем форму поиска со стрнацы с результатами. мы изем только по названию товара
  if ($form_id == 'search_form') {
    $form['#access'] = FALSE;
  }
}

/**
 * Implement hook_block_info().
 */
function custom_stepug_block_info() {
  $blocks = array();
  $blocks['stepug_user_links'] = array(
    'info' => t('Stepug user links block'),
    'cache' => DRUPAL_NO_CACHE,
  );
  return $blocks;
}

/**
 * Implement hook_block_view().
 */
function custom_stepug_block_view($delta = '') {
  global $user;

  $block = array();
  switch ($delta) {
    case 'stepug_user_links':
      if ($user->uid) {
        $block['content'] = l($user->name, 'user/' . $user->uid) .' | ' . l(t('Log out'), 'user/logout');
      }
      break;
  }
  return $block;
}